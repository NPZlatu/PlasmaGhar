"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var SignUp=function(){function e(){_classCallCheck(this,e),this.clicked=!1,this.states=[],this.model=this.getModel(),this.onSignUpConfirmClick=this.onSignUpConfirmClick.bind(this),this.checkValidation=this.checkValidation.bind(this),this.setModalListeners=this.setModalListeners.bind(this),this.setUpListeners()}return _createClass(e,[{key:"getModel",value:function(){return[{selector:"phoneNumber",rules:{regex:{value:/^[0-9]{10}$/,error:"Phone Number must have 10 digits."}},value:""},{selector:"bloodGroup",rules:{required:{value:!0,conditions:[{selector:"input#gridRadios2:checked",value:!0}],error:"Blood Group is required."}},value:""},{selector:"state",rules:{required:{value:!0,error:"State is required."}},value:""},{selector:"district",rules:{required:{value:!0,error:"District is required."}},value:""},{selector:"password",rules:{regex:{value:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/,error:"Password must be minimum eight characters, at least one letter and one number"}},value:""},{selector:"confirm-password",rules:{match:{value:"password",error:"Confirm Password does not match."}},value:""}]}}]),_createClass(e,[{key:"setUpListeners",value:function(){$(".confirm-signup").click(this.onSignUpConfirmClick),this.setUpOnBlurListeners(),this.setUpOnChangeListeners(),this.setModalListeners()}},{key:"setModalListeners",value:function(){var e=this;$("#signupModal").on("shown.bs.modal",function(){0===e.states.length&&e.requestStates()}),$("#signupModal").on("hidden.bs.modal",function(){e.resetForm()})}},{key:"setUpOnBlurListeners",value:function(){var n=this;this.model.map(function(e,t){var r=e.selector,i=e.rules,s=n;$("#".concat(r)).blur(function(){s.clicked&&s.showError(r,i,t)})})}},{key:"setUpOnChangeListeners",value:function(){var t=this;$("#state").on("change",function(){var e;this.value?(e=$("option:selected",this).data("code"),console.log(e),t.requestDistricts(e)):$(".district-wrapper").hide()}),$("input#gridRadios2").on("click",function(){$("input#gridRadios1").prop("checked",!1);var e=$("#bloodGroup").next();e.text(""),e.hide()})}},{key:"showError",value:function(e,t,r){var i=$("#".concat(e)),e=i.val(),i=i.next(),s="",n=!0;return!e&&t.required&&t.required.value?t.required.conditions?t.required.conditions.forEach(function(e){e=e.selector;$(e).val()||(n=!1,s=t.required.error)}):(n=!1,s=t.required.error):t.regex?(n=new RegExp(t.regex.value).test(e),t.required&&!1===t.required.value&&(n=!e||n),n||(s=t.regex.error)):t.match&&e!==$("#".concat(t.match.value)).val()&&(n=!1,s=t.match.error),!n&&s?(i.text(s),i.show()):(i.text(""),i.hide()),this.model[r].value=e,n}},{key:"checkValidation",value:function(){for(var e=!0,t=0;t<this.model.length;t++){var r=this.model[t],i=r.selector,r=r.rules;this.showError(i,r,t)||(e=!1)}return e}},{key:"resetForm",value:function(){this.model.forEach(function(e){var t=e.selector;$("#".concat(t)).val(""),e.value=""}),$(".invalid-feedback").hide()}},{key:"checkIfTermsAndConditionsAgreed",value:function(){var e=!0;return $("#terms:checked").val()||($.toaster({settings:{timeout:5e3}}),$.toaster({priority:"danger",title:"Terms and Conditions",message:"You must agree to our terms and conditions to proceed further."}),e=!1),e}},{key:"onSignUpConfirmClick",value:function(){this.clicked=!0,this.checkValidation()&&this.checkIfTermsAndConditionsAgreed()&&this.registerUser()}},{key:"requestStates",value:function(){var t=this;axios.get("/address/get-states").then(function(e){e=e.data;e&&0<e.length&&(t.states=e,t.populateStates())}).catch(function(e){})}},{key:"requestDistricts",value:function(e){var t=this;axios.get("/address/get-districts?code=".concat(e)).then(function(e){e=e.data;e&&0<e.length&&t.populateDistricts(e)}).catch(function(e){})}},{key:"populateStates",value:function(){var e=this.states;$("#state").html("");for(var t="<option selected value>select state</option>",r=0;r<e.length;r++)t+="<option data-code=".concat(e[r].code," value=").concat(e[r].name,">").concat(e[r].name,"</option>");$("#state").append(t)}},{key:"populateDistricts",value:function(e){$("#district").html("");for(var t="<option selected value>select district</option>",r=0;r<e.length;r++)t+="<option data-code=".concat(e[r].code," value=").concat(e[r].name,">").concat(e[r].name,"</option>");$(".district-wrapper").show(),$("#district").append(t)}},{key:"registerUser",value:function(){var t=this,e=this.model,e={phone_number:e[0].value,blood_group:e[1].value,state:e[2].value,district:e[3].value,password:e[4].value,user_role:$("input#gridRadios1:checked").val()?0:1};axios.post("/user/save",e).then(function(e){e=e.data;console.log(e),e&&e.success?(t.resetForm(),$("#signupModal").modal("hide"),$.toaster({settings:{timeout:15e3}}),$.toaster({priority:"success",title:"Success",message:"You are successfully registered, we have sent a confirmation link on your phone. \n          Please click on that link to verify your phone."})):e&&e.error&&"exist already"===e.error&&((e=$("#phoneNumber").next()).text("User already exists with this phone number"),e.show())}).catch(function(e){console.log(e),$.toaster({settings:{timeout:5e3}}),$.toaster({priority:"danger",title:"Error",message:"Something is wrong. Please try later"})})}}]),e}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}$(document).ready(function(){axios.defaults.headers.post["X-CSRF-Token"]=$('meta[name="csrf-token"]').attr("content"),axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",new SignUp});var SignIn=function(){function e(){_classCallCheck(this,e),this.clicked=!1,this.model=[{selector:"loginPhone",rules:{regex:{value:/^[0-9]{10}$/,error:"Phone Number must have 10 digits."}},value:""},{selector:"loginPassword",rules:{required:{value:!0,error:"Password is required."}},value:""}],this.onSignInConfirmClick=this.onSignInConfirmClick.bind(this),this.checkValidation=this.checkValidation.bind(this),this.setModalListeners=this.setModalListeners.bind(this),this.setUpListeners()}return _createClass(e,[{key:"setUpListeners",value:function(){$(".confirm-signin").click(this.onSignInConfirmClick),this.setUpOnBlurListeners(),this.setModalListeners()}},{key:"setModalListeners",value:function(){var e=this;$("#signinModal").on("hidden.bs.modal",function(){window.location.href.includes("/user/login")?window.location.href="/":e.resetForm()})}},{key:"setUpOnBlurListeners",value:function(){var n=this;this.model.map(function(e,t){var r=e.selector,i=e.rules,s=n;$("#".concat(r)).blur(function(){s.clicked&&s.showError(r,i,t)})})}},{key:"resetForm",value:function(){this.model.forEach(function(e){var t=e.selector;$("#".concat(t)).val(""),e.value=""}),$(".invalid-feedback").hide()}},{key:"showError",value:function(e,t,r){var i=$("#".concat(e)),s=i.val(),n=i.next(),e="",i=!0;return!s&&t.required&&t.required.value?(i=!1,e=t.required.error):t.regex&&(i=new RegExp(t.regex.value).test(s),t.required&&!1===t.required.value&&(i=!s||i),i||(e=t.regex.error)),!i&&e?(n.text(e),n.show()):(n.text(""),n.hide()),this.model[r].value=s,i}},{key:"checkValidation",value:function(){for(var e=!0,t=0;t<this.model.length;t++){var r=this.model[t],i=r.selector,r=r.rules;this.showError(i,r,t)||(e=!1)}return e}},{key:"onSignInConfirmClick",value:function(){this.clicked=!0,this.checkValidation()&&this.loginUser()}},{key:"loginUser",value:function(){var e=this.model,e={phone_number:e[0].value,password:e[1].value,remember_me:$("#rememberMe:checked").val()?1:0};axios.post("/user/login",e).then(function(e){e=e.data;e&&e.success?window.location.href="/dashboard":($.toaster({settings:{timeout:5e3}}),$.toaster({priority:"danger",title:"Error",message:"Invalid phone and/or password"}))}).catch(function(e){alert("Error while saving the data")})}}]),e}();$(document).ready(function(){new SignIn});