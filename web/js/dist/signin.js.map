{"version":3,"sources":["../../es6/signin.js"],"names":["SignIn","clicked","model","selector","rules","regex","value","error","required","onSignInConfirmClick","bind","checkValidation","setModalListeners","setUpListeners","$","click","setUpOnBlurListeners","on","window","location","href","includes","resetForm","map","v","index","self","blur","showError","forEach","val","hide","element","errorElement","next","message","valid","RegExp","test","text","show","retrunVal","i","length","loginUser","data","phone_number","password","remember_me","axios","post","then","response","success","toaster","settings","timeout","priority","title","alert","document","ready"],"mappings":";;;;;;;;IAAMA,M;AACJ,oBAAc;AAAA;;AACZ,SAAKC,OAAL,GAAe,KAAf;AACA,SAAKC,KAAL,GAAa,CACX;AACEC,MAAAA,QAAQ,EAAE,YADZ;AAEEC,MAAAA,KAAK,EAAE;AACLC,QAAAA,KAAK,EAAE;AACLC,UAAAA,KAAK,EAAE,aADF;AAELC,UAAAA,KAAK,EAAE;AAFF;AADF,OAFT;AAQED,MAAAA,KAAK,EAAE;AART,KADW,EAWX;AACEH,MAAAA,QAAQ,EAAE,eADZ;AAEEC,MAAAA,KAAK,EAAE;AACLI,QAAAA,QAAQ,EAAE;AACRF,UAAAA,KAAK,EAAE,IADC;AAERC,UAAAA,KAAK,EAAE;AAFC;AADL,OAFT;AAQED,MAAAA,KAAK,EAAE;AART,KAXW,CAAb;AAsBA,SAAKG,oBAAL,GAA4B,KAAKA,oBAAL,CAA0BC,IAA1B,CAA+B,IAA/B,CAA5B;AACA,SAAKC,eAAL,GAAuB,KAAKA,eAAL,CAAqBD,IAArB,CAA0B,IAA1B,CAAvB;AACA,SAAKE,iBAAL,GAAyB,KAAKA,iBAAL,CAAuBF,IAAvB,CAA4B,IAA5B,CAAzB;AACA,SAAKG,cAAL;AACD;;;;qCAEgB;AACfC,MAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqBC,KAArB,CAA2B,KAAKN,oBAAhC;AACA,WAAKO,oBAAL;AACA,WAAKJ,iBAAL;AACD;;;wCAEmB;AAAA;;AAClBE,MAAAA,CAAC,CAAC,cAAD,CAAD,CAAkBG,EAAlB,CAAqB,iBAArB,EAAwC,YAAM;AAC5C,YAAIC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,QAArB,CAA8B,aAA9B,CAAJ,EAAkD;AAChDH,UAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuB,GAAvB;AACD,SAFD,MAEO,KAAI,CAACE,SAAL;AACR,OAJD;AAKD;;;2CAEsB;AAAA;;AACrB,WAAKpB,KAAL,CAAWqB,GAAX,CAAe,UAACC,CAAD,EAAIC,KAAJ,EAAc;AAAA,YACnBtB,QADmB,GACCqB,CADD,CACnBrB,QADmB;AAAA,YACTC,KADS,GACCoB,CADD,CACTpB,KADS;AAE3B,YAAMsB,IAAI,GAAG,MAAb;AACAZ,QAAAA,CAAC,YAAKX,QAAL,EAAD,CAAkBwB,IAAlB,CAAuB,YAAY;AACjC,cAAID,IAAI,CAACzB,OAAT,EAAkByB,IAAI,CAACE,SAAL,CAAezB,QAAf,EAAyBC,KAAzB,EAAgCqB,KAAhC;AACnB,SAFD;AAGD,OAND;AAOD;;;gCAEW;AACV,WAAKvB,KAAL,CAAW2B,OAAX,CAAmB,UAACL,CAAD,EAAO;AAAA,YAChBrB,QADgB,GACHqB,CADG,CAChBrB,QADgB;AAExBW,QAAAA,CAAC,YAAKX,QAAL,EAAD,CAAkB2B,GAAlB,CAAsB,EAAtB;AACAN,QAAAA,CAAC,CAAClB,KAAF,GAAU,EAAV;AACD,OAJD;AAKAQ,MAAAA,CAAC,CAAC,mBAAD,CAAD,CAAuBiB,IAAvB;AACD;;;8BAES5B,Q,EAAUC,K,EAAOqB,K,EAAO;AAChC,UAAMO,OAAO,GAAGlB,CAAC,YAAKX,QAAL,EAAjB;AACA,UAAMG,KAAK,GAAG0B,OAAO,CAACF,GAAR,EAAd;AACA,UAAMG,YAAY,GAAGD,OAAO,CAACE,IAAR,EAArB;AACA,UAAIC,OAAO,GAAG,EAAd;AACA,UAAIC,KAAK,GAAG,IAAZ;;AAEA,UAAI,CAAC9B,KAAD,IAAUF,KAAK,CAACI,QAAhB,IAA4BJ,KAAK,CAACI,QAAN,CAAeF,KAA/C,EAAsD;AACpD8B,QAAAA,KAAK,GAAG,KAAR;AACAD,QAAAA,OAAO,GAAG/B,KAAK,CAACI,QAAN,CAAeD,KAAzB;AACD,OAHD,MAGO,IAAIH,KAAK,CAACC,KAAV,EAAiB;AACtB+B,QAAAA,KAAK,GAAG,IAAIC,MAAJ,CAAWjC,KAAK,CAACC,KAAN,CAAYC,KAAvB,EAA8BgC,IAA9B,CAAmChC,KAAnC,CAAR;;AACA,YAAIF,KAAK,CAACI,QAAN,IAAkBJ,KAAK,CAACI,QAAN,CAAeF,KAAf,KAAyB,KAA/C,EAAsD;AACpD8B,UAAAA,KAAK,GAAG,CAAC9B,KAAD,IAAU8B,KAAlB;AACD;;AACD,YAAI,CAACA,KAAL,EAAYD,OAAO,GAAG/B,KAAK,CAACC,KAAN,CAAYE,KAAtB;AACb;;AAED,UAAI,CAAC6B,KAAD,IAAUD,OAAd,EAAuB;AACrBF,QAAAA,YAAY,CAACM,IAAb,CAAkBJ,OAAlB;AACAF,QAAAA,YAAY,CAACO,IAAb;AACD,OAHD,MAGO;AACLP,QAAAA,YAAY,CAACM,IAAb,CAAkB,EAAlB;AACAN,QAAAA,YAAY,CAACF,IAAb;AACD;;AACD,WAAK7B,KAAL,CAAWuB,KAAX,EAAkBnB,KAAlB,GAA0BA,KAA1B;AACA,aAAO8B,KAAP;AACD;;;sCAEiB;AAChB,UAAIA,KAAK,GAAG,IAAZ;AACA,UAAIK,SAAS,GAAG,IAAhB;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKxC,KAAL,CAAWyC,MAA/B,EAAuCD,CAAC,EAAxC,EAA4C;AAAA,4BACd,KAAKxC,KAAL,CAAWwC,CAAX,CADc;AAAA,YAClCvC,QADkC,iBAClCA,QADkC;AAAA,YACxBC,KADwB,iBACxBA,KADwB;AAE1CgC,QAAAA,KAAK,GAAG,KAAKR,SAAL,CAAezB,QAAf,EAAyBC,KAAzB,EAAgCsC,CAAhC,CAAR;AACA,YAAI,CAACN,KAAL,EAAYK,SAAS,GAAG,KAAZ;AACb;;AACD,aAAOA,SAAP;AACD;;;2CAEsB;AACrB,WAAKxC,OAAL,GAAe,IAAf;AACA,UAAMmC,KAAK,GAAG,KAAKzB,eAAL,EAAd;;AACA,UAAIyB,KAAJ,EAAW;AACT,aAAKQ,SAAL;AACD;AACF;;;gCAEW;AAAA,UACF1C,KADE,GACQ,IADR,CACFA,KADE;AAEV,UAAM2C,IAAI,GAAG;AACXC,QAAAA,YAAY,EAAE5C,KAAK,CAAC,CAAD,CAAL,CAASI,KADZ;AAEXyC,QAAAA,QAAQ,EAAE7C,KAAK,CAAC,CAAD,CAAL,CAASI,KAFR;AAGX0C,QAAAA,WAAW,EAAElC,CAAC,CAAC,qBAAD,CAAD,CAAyBgB,GAAzB,KAAiC,CAAjC,GAAqC;AAHvC,OAAb;AAMAmB,MAAAA,KAAK,CACFC,IADH,CACQ,aADR,EACuBL,IADvB,EAEGM,IAFH,CAEQ,gBAAwB;AAAA,YAAfC,QAAe,QAArBP,IAAqB;;AAC5B,YAAIO,QAAQ,IAAIA,QAAQ,CAACC,OAAzB,EAAkC;AAChCnC,UAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuB,YAAvB;AACD,SAFD,MAEO;AACLN,UAAAA,CAAC,CAACwC,OAAF,CAAU;AAAEC,YAAAA,QAAQ,EAAE;AAAEC,cAAAA,OAAO,EAAE;AAAX;AAAZ,WAAV;AACA1C,UAAAA,CAAC,CAACwC,OAAF,CAAU;AACRG,YAAAA,QAAQ,EAAE,QADF;AAERC,YAAAA,KAAK,EAAE,OAFC;AAGRvB,YAAAA,OAAO;AAHC,WAAV;AAKD;AACF,OAbH,WAcS,UAAU5B,KAAV,EAAiB;AACtBoD,QAAAA,KAAK,CAAC,6BAAD,CAAL;AACD,OAhBH;AAiBD;;;;;;AAGH7C,CAAC,CAAC8C,QAAD,CAAD,CAAYC,KAAZ,CAAkB,YAAY;AAC5B,MAAI7D,MAAJ;AACD,CAFD","sourcesContent":["class SignIn {\n  constructor() {\n    this.clicked = false;\n    this.model = [\n      {\n        selector: \"loginPhone\",\n        rules: {\n          regex: {\n            value: /^[0-9]{10}$/,\n            error: \"Phone Number must have 10 digits.\",\n          },\n        },\n        value: \"\",\n      },\n      {\n        selector: \"loginPassword\",\n        rules: {\n          required: {\n            value: true,\n            error: \"Password is required.\",\n          },\n        },\n        value: \"\",\n      },\n    ];\n    this.onSignInConfirmClick = this.onSignInConfirmClick.bind(this);\n    this.checkValidation = this.checkValidation.bind(this);\n    this.setModalListeners = this.setModalListeners.bind(this);\n    this.setUpListeners();\n  }\n\n  setUpListeners() {\n    $(\".confirm-signin\").click(this.onSignInConfirmClick);\n    this.setUpOnBlurListeners();\n    this.setModalListeners();\n  }\n\n  setModalListeners() {\n    $(\"#signinModal\").on(\"hidden.bs.modal\", () => {\n      if (window.location.href.includes(\"/user/login\")) {\n        window.location.href = \"/\";\n      } else this.resetForm();\n    });\n  }\n\n  setUpOnBlurListeners() {\n    this.model.map((v, index) => {\n      const { selector, rules } = v;\n      const self = this;\n      $(`#${selector}`).blur(function () {\n        if (self.clicked) self.showError(selector, rules, index);\n      });\n    });\n  }\n\n  resetForm() {\n    this.model.forEach((v) => {\n      const { selector } = v;\n      $(`#${selector}`).val(\"\");\n      v.value = \"\";\n    });\n    $(\".invalid-feedback\").hide();\n  }\n\n  showError(selector, rules, index) {\n    const element = $(`#${selector}`);\n    const value = element.val();\n    const errorElement = element.next();\n    let message = \"\";\n    let valid = true;\n\n    if (!value && rules.required && rules.required.value) {\n      valid = false;\n      message = rules.required.error;\n    } else if (rules.regex) {\n      valid = new RegExp(rules.regex.value).test(value);\n      if (rules.required && rules.required.value === false) {\n        valid = !value || valid;\n      }\n      if (!valid) message = rules.regex.error;\n    }\n\n    if (!valid && message) {\n      errorElement.text(message);\n      errorElement.show();\n    } else {\n      errorElement.text(\"\");\n      errorElement.hide();\n    }\n    this.model[index].value = value;\n    return valid;\n  }\n\n  checkValidation() {\n    let valid = true;\n    let retrunVal = true;\n    for (let i = 0; i < this.model.length; i++) {\n      const { selector, rules } = this.model[i];\n      valid = this.showError(selector, rules, i);\n      if (!valid) retrunVal = false;\n    }\n    return retrunVal;\n  }\n\n  onSignInConfirmClick() {\n    this.clicked = true;\n    const valid = this.checkValidation();\n    if (valid) {\n      this.loginUser();\n    }\n  }\n\n  loginUser() {\n    const { model } = this;\n    const data = {\n      phone_number: model[0].value,\n      password: model[1].value,\n      remember_me: $(\"#rememberMe:checked\").val() ? 1 : 0,\n    };\n\n    axios\n      .post(\"/user/login\", data)\n      .then(({ data: response }) => {\n        if (response && response.success) {\n          window.location.href = \"/dashboard\";\n        } else {\n          $.toaster({ settings: { timeout: 5000 } });\n          $.toaster({\n            priority: \"danger\",\n            title: \"Error\",\n            message: `Invalid phone and/or password`,\n          });\n        }\n      })\n      .catch(function (error) {\n        alert(\"Error while saving the data\");\n      });\n  }\n}\n\n$(document).ready(function () {\n  new SignIn();\n});\n"],"file":"signin.js"}