{"version":3,"sources":["../../es6/signin.js"],"names":["SignIn","clicked","model","selector","rules","regex","value","error","required","onSignInConfirmClick","bind","checkValidation","setModalListeners","setUpListeners","$","click","modal","window","location","href","includes","setUpOnBlurListeners","on","resetForm","addClass","map","v","index","self","blur","showError","forEach","val","hide","element","errorElement","next","message","valid","RegExp","test","text","show","retrunVal","i","length","loginUser","data","phone_number","password","remember_me","axios","post","then","response","success","nextUrl","attr","hasClass","toaster","settings","timeout","priority","title","console","log","document","ready"],"mappings":"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","sourcesContent":["class SignIn {\n  constructor() {\n    this.clicked = false;\n    this.model = [\n      {\n        selector: \"loginPhone\",\n        rules: {\n          regex: {\n            value: /^[0-9]{10}$/,\n            error: \"Phone Number must have 10 digits.\",\n          },\n        },\n        value: \"\",\n      },\n      {\n        selector: \"loginPassword\",\n        rules: {\n          required: {\n            value: true,\n            error: \"Password is required.\",\n          },\n        },\n        value: \"\",\n      },\n    ];\n    this.onSignInConfirmClick = this.onSignInConfirmClick.bind(this);\n    this.checkValidation = this.checkValidation.bind(this);\n    this.setModalListeners = this.setModalListeners.bind(this);\n    this.setUpListeners();\n  }\n\n  setUpListeners() {\n    $(\".confirm-signin\").click(this.onSignInConfirmClick);\n    $(\".register-signin\").click(function () {\n      $(\"#signinModal\").modal(\"hide\");\n      if (!window.location.href.includes(\"/user/login\")) {\n        $(\"#signupModal\").modal(\"show\");\n      } else {\n        window.location.href = \"/user/register\";\n      }\n    });\n    this.setUpOnBlurListeners();\n    this.setModalListeners();\n  }\n\n  setModalListeners() {\n    $(\"#signinModal\").on(\"hidden.bs.modal\", () => {\n      if (\n        window.location.href.includes(\"/user/confirm\") ||\n        window.location.href.includes(\"/user/login\")\n      ) {\n        window.location.href = \"/\";\n      } else this.resetForm();\n    });\n\n    $(\"#signinModal\").on(\"shown.bs.modal\", () => {\n      $(\"body\").addClass(\"modal-open\");\n    });\n  }\n\n  setUpOnBlurListeners() {\n    this.model.map((v, index) => {\n      const { selector, rules } = v;\n      const self = this;\n      $(`#${selector}`).blur(function () {\n        if (self.clicked) self.showError(selector, rules, index);\n      });\n    });\n  }\n\n  resetForm() {\n    this.model.forEach((v) => {\n      const { selector } = v;\n      $(`#${selector}`).val(\"\");\n      v.value = \"\";\n    });\n    $(\".invalid-feedback\").hide();\n  }\n\n  showError(selector, rules, index) {\n    const element = $(`#${selector}`);\n    const value = element.val();\n    const errorElement = element.next();\n    let message = \"\";\n    let valid = true;\n\n    if (!value && rules.required && rules.required.value) {\n      valid = false;\n      message = rules.required.error;\n    } else if (rules.regex) {\n      valid = new RegExp(rules.regex.value).test(value);\n      if (rules.required && rules.required.value === false) {\n        valid = !value || valid;\n      }\n      if (!valid) message = rules.regex.error;\n    }\n\n    if (!valid && message) {\n      errorElement.text(message);\n      errorElement.show();\n    } else {\n      errorElement.text(\"\");\n      errorElement.hide();\n    }\n    this.model[index].value = value;\n    return valid;\n  }\n\n  checkValidation() {\n    let valid = true;\n    let retrunVal = true;\n    for (let i = 0; i < this.model.length; i++) {\n      const { selector, rules } = this.model[i];\n      valid = this.showError(selector, rules, i);\n      if (!valid) retrunVal = false;\n    }\n    return retrunVal;\n  }\n\n  onSignInConfirmClick() {\n    this.clicked = true;\n    const valid = this.checkValidation();\n    if (valid) {\n      this.loginUser();\n    }\n  }\n\n  loginUser() {\n    const { model } = this;\n    const data = {\n      phone_number: model[0].value,\n      password: model[1].value,\n      remember_me: $(\"#rememberMe:checked\").val() ? 1 : 0,\n    };\n\n    axios\n      .post(\"/user/login\", data)\n      .then(({ data: response }) => {\n        if (response && response.success) {\n          if (typeof $(\".confirm-signin\").data(\"nexturl\") !== \"undefined\") {\n            const nextUrl = $(\".confirm-signin\").attr(\"data-nexturl\");\n            window.location.href = nextUrl;\n          } else if ($(\"#searchModal\").hasClass(\"show\")) {\n            $(\"#signinModal\").modal(\"hide\");\n          } else window.location.href = \"/dashboard\";\n        } else {\n          $.toaster({ settings: { timeout: 5000 } });\n          $.toaster({\n            priority: \"danger\",\n            title: \"Error\",\n            message: `Invalid phone and/or password`,\n          });\n        }\n      })\n      .catch(function (error) {\n        console.log(error);\n        console.log(\"Error while saving the data\");\n      });\n  }\n}\n\n$(document).ready(function () {\n  new SignIn();\n});\n"],"file":"signin.js"}