{"version":3,"sources":["../../es6/signin.js"],"names":["SignIn","clicked","model","selector","rules","regex","value","error","required","onSignInConfirmClick","bind","checkValidation","setModalListeners","setUpListeners","$","click","modal","window","location","href","includes","setUpOnBlurListeners","on","resetForm","addClass","map","v","index","self","blur","showError","forEach","val","hide","element","errorElement","next","message","valid","RegExp","test","text","show","retrunVal","i","length","loginUser","data","email","password","remember_me","axios","post","then","response","console","log","success","nextUrl","attr","hasClass","toaster","settings","timeout","priority","title","document","ready"],"mappings":"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","sourcesContent":["class SignIn {\r\n  constructor() {\r\n    this.clicked = false;\r\n    this.model = [\r\n      {\r\n        selector: \"loginEmail\",\r\n        rules: {\r\n          regex: {\r\n            value: /\\S+@\\S+\\.\\S+/,\r\n            error: \"Valid email address is required.\",\r\n          },\r\n        },\r\n        value: \"\",\r\n      },\r\n      {\r\n        selector: \"loginPassword\",\r\n        rules: {\r\n          required: {\r\n            value: true,\r\n            error: \"Password is required.\",\r\n          },\r\n        },\r\n        value: \"\",\r\n      },\r\n    ];\r\n    this.onSignInConfirmClick = this.onSignInConfirmClick.bind(this);\r\n    this.checkValidation = this.checkValidation.bind(this);\r\n    this.setModalListeners = this.setModalListeners.bind(this);\r\n    this.setUpListeners();\r\n  }\r\n\r\n  setUpListeners() {\r\n    $(\".confirm-signin\").click(this.onSignInConfirmClick);\r\n    $(\".register-signin\").click(function () {\r\n      $(\"#signinModal\").modal(\"hide\");\r\n      if (!window.location.href.includes(\"/user/login\")) {\r\n        $(\"#signupModal\").modal(\"show\");\r\n      } else {\r\n        window.location.href = \"/user/register\";\r\n      }\r\n    });\r\n    this.setUpOnBlurListeners();\r\n    this.setModalListeners();\r\n  }\r\n\r\n  setModalListeners() {\r\n    $(\"#signinModal\").on(\"hidden.bs.modal\", () => {\r\n      if (\r\n        window.location.href.includes(\"/user/confirm\") ||\r\n        window.location.href.includes(\"/user/login\")\r\n      ) {\r\n        window.location.href = \"/\";\r\n      } else this.resetForm();\r\n    });\r\n\r\n    $(\"#signinModal\").on(\"shown.bs.modal\", () => {\r\n      $(\"body\").addClass(\"modal-open\");\r\n    });\r\n  }\r\n\r\n  setUpOnBlurListeners() {\r\n    this.model.map((v, index) => {\r\n      const { selector, rules } = v;\r\n      const self = this;\r\n      $(`#${selector}`).blur(function () {\r\n        if (self.clicked) self.showError(selector, rules, index);\r\n      });\r\n    });\r\n  }\r\n\r\n  resetForm() {\r\n    this.model.forEach((v) => {\r\n      const { selector } = v;\r\n      $(`#${selector}`).val(\"\");\r\n      v.value = \"\";\r\n    });\r\n    $(\".invalid-feedback\").hide();\r\n  }\r\n\r\n  showError(selector, rules, index) {\r\n    const element = $(`#${selector}`);\r\n    const value = element.val();\r\n    const errorElement = element.next();\r\n    let message = \"\";\r\n    let valid = true;\r\n\r\n    if (!value && rules.required && rules.required.value) {\r\n      valid = false;\r\n      message = rules.required.error;\r\n    } else if (rules.regex) {\r\n      valid = new RegExp(rules.regex.value).test(value);\r\n      if (rules.required && rules.required.value === false) {\r\n        valid = !value || valid;\r\n      }\r\n      if (!valid) message = rules.regex.error;\r\n    }\r\n\r\n    if (!valid && message) {\r\n      errorElement.text(message);\r\n      errorElement.show();\r\n    } else {\r\n      errorElement.text(\"\");\r\n      errorElement.hide();\r\n    }\r\n    this.model[index].value = value;\r\n    return valid;\r\n  }\r\n\r\n  checkValidation() {\r\n    let valid = true;\r\n    let retrunVal = true;\r\n    for (let i = 0; i < this.model.length; i++) {\r\n      const { selector, rules } = this.model[i];\r\n      valid = this.showError(selector, rules, i);\r\n      if (!valid) retrunVal = false;\r\n    }\r\n    return retrunVal;\r\n  }\r\n\r\n  onSignInConfirmClick() {\r\n    this.clicked = true;\r\n    const valid = this.checkValidation();\r\n    if (valid) {\r\n      this.loginUser();\r\n    }\r\n  }\r\n\r\n  loginUser() {\r\n    const { model } = this;\r\n    const data = {\r\n      email: model[0].value,\r\n      password: model[1].value,\r\n      remember_me: $(\"#rememberMe:checked\").val() ? 1 : 0,\r\n    };\r\n\r\n    axios\r\n      .post(\"/user/login\", data)\r\n      .then(({ data: response }) => {\r\n        console.log(response);\r\n        if (response && response.success) {\r\n          if (typeof $(\".confirm-signin\").data(\"nexturl\") !== \"undefined\") {\r\n            const nextUrl = $(\".confirm-signin\").attr(\"data-nexturl\");\r\n            window.location.href = nextUrl;\r\n          } else if ($(\"#searchModal\").hasClass(\"show\")) {\r\n            $(\"#signinModal\").modal(\"hide\");\r\n          } else window.location.href = \"/dashboard\";\r\n        } else if (\r\n          response &&\r\n          response.error &&\r\n          response.error === \"account not confirmed\"\r\n        ) {\r\n          $.toaster({ settings: { timeout: 15000 } });\r\n          $.toaster({\r\n            priority: \"danger\",\r\n            title: \"Error\",\r\n            message: `Your account has not been activated yet. Please check your email and click on the activation link. `,\r\n          });\r\n        } else {\r\n          $.toaster({ settings: { timeout: 5000 } });\r\n          $.toaster({\r\n            priority: \"danger\",\r\n            title: \"Error\",\r\n            message: `Invalid email and/or password`,\r\n          });\r\n        }\r\n      })\r\n      .catch(function (error) {\r\n        console.log(error);\r\n        console.log(\"Error while saving the data\");\r\n      });\r\n  }\r\n}\r\n\r\n$(document).ready(function () {\r\n  new SignIn();\r\n});\r\n"],"file":"signin.js"}